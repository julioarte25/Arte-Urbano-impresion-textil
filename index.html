using System;
using System.Collections.Generic;
using System.Linq;
using System.IO;
using System.Drawing;
using System.Drawing.Imaging;

namespace ArteUrbanoNomina
{
    public class Empleado
    {
        public int Id { get; set; }
        public string Nombre { get; set; }
        public string Cedula { get; set; }
        public string Departamento { get; set; }
        public string Cargo { get; set; }
        public decimal SueldoBase { get; set; } = 3000m; // Sueldo base RD$3,000
        public Dictionary<string, decimal> Incentivos { get; set; } = new Dictionary<string, decimal>
        {
            {"Puntualidad", 0},
            {"Cooperación", 0},
            {"Disciplina", 0},
            {"No uso del celular", 0}
        };
        public decimal Descuentos { get; set; }
        public string FotoPerfilPath { get; set; }
        public DateTime FechaContratacion { get; set; }
    }

    public static class EmpresaInfo
    {
        public const string Nombre = "ARTE URBANO";
        public const string Slogan = "Expertos en impresión textil premium";
        public const string Direccion = "Detrás de la Urbanización La Terraza, Santiago, Rep. Dom.";
        public const string Telefono = "809-909-0455";
        public const string Email = "julio271975@hotmail.com";
        public const string RNC = "1-23-45678-9";
    }

    class Program
    {
        static List<Empleado> empleados = new List<Empleado>();
        static readonly string directorioFotos = Path.Combine(Directory.GetCurrentDirectory(), "FotosEmpleados");
        static readonly string fotoEjemploPath = Path.Combine(directorioFotos, "empleado_ejemplo.jpg");

        static void Main(string[] args)
        {
            ConfigurarDirectorios();
            CrearFotoEjemplo();

            while (true)
            {
                MostrarMenuPrincipal();
                var opcion = Console.ReadLine();

                switch (opcion)
                {
                    case "1": RegistrarEmpleado(); break;
                    case "2": CalcularNomina(); break;
                    case "3": MostrarRecibo(); break;
                    case "4": AsignarFoto(); break;
                    case "5": VerFoto(); break;
                    case "6": return;
                    default: MostrarError("Opción inválida"); break;
                }
            }
        }

        static void ConfigurarDirectorios()
        {
            if (!Directory.Exists(directorioFotos))
                Directory.CreateDirectory(directorioFotos);
        }

        static void CrearFotoEjemplo()
        {
            if (!File.Exists(fotoEjemploPath))
            {
                using (var bitmap = new Bitmap(200, 200))
                {
                    using (var g = Graphics.FromImage(bitmap))
                    {
                        g.Clear(Color.LightGray);
                        g.DrawString("EJEMPLO", new Font("Arial", 20), Brushes.Black, 50, 80);
                        g.DrawString("Foto Perfil", new Font("Arial", 12), Brushes.Black, 60, 120);
                    }
                    bitmap.Save(fotoEjemploPath, ImageFormat.Jpeg);
                }
            }
        }

        static void MostrarMenuPrincipal()
        {
            Console.Clear();
            Console.ForegroundColor = ConsoleColor.Red;
            Console.WriteLine("═══════════════════════════════════════════════");
            Console.WriteLine($"           {EmpresaInfo.Nombre}");
            Console.WriteLine($"       {EmpresaInfo.Slogan}");
            Console.WriteLine("═══════════════════════════════════════════════");
            Console.ForegroundColor = ConsoleColor.White;
            Console.WriteLine($"📍 {EmpresaInfo.Direccion}");
            Console.WriteLine($"📞 {EmpresaInfo.Telefono} | ✉ {EmpresaInfo.Email}");
            Console.ForegroundColor = ConsoleColor.Red;
            Console.WriteLine("═══════════════════════════════════════════════");
            Console.ForegroundColor = ConsoleColor.White;

            Console.WriteLine("\n1. Registrar Empleado");
            Console.WriteLine("2. Calcular Nómina");
            Console.WriteLine("3. Generar Recibo");
            Console.WriteLine("4. Asignar Foto a Empleado");
            Console.WriteLine("5. Ver Foto de Empleado");
            Console.WriteLine("6. Salir");
            Console.Write("\nSeleccione una opción: ");
        }

        static void RegistrarEmpleado()
        {
            Console.Clear();
            Console.WriteLine("📝 REGISTRAR NUEVO EMPLEADO\n");

            try
            {
                var empleado = new Empleado();

                Console.Write("ID: ");
                empleado.Id = int.Parse(Console.ReadLine());

                Console.Write("Nombre completo: ");
                empleado.Nombre = Console.ReadLine();

                Console.Write("Cédula: ");
                empleado.Cedula = Console.ReadLine();

                Console.Write("Departamento: ");
                empleado.Departamento = Console.ReadLine();

                Console.Write("Cargo: ");
                empleado.Cargo = Console.ReadLine();

                Console.Write("Fecha de contratación (dd/mm/aaaa): ");
                empleado.FechaContratacion = DateTime.Parse(Console.ReadLine());

                // Asignar foto de ejemplo por defecto
                empleado.FotoPerfilPath = fotoEjemploPath;

                empleados.Add(empleado);
                MostrarExito("Empleado registrado exitosamente!");
            }
            catch (Exception ex)
            {
                MostrarError($"Error: {ex.Message}");
            }
        }

        static void CalcularNomina()
        {
            Console.Clear();
            Console.WriteLine("💰 CALCULAR NÓMINA\n");

            try
            {
                Console.Write("ID del empleado: ");
                var id = int.Parse(Console.ReadLine());
                var empleado = empleados.FirstOrDefault(e => e.Id == id);

                if (empleado == null)
                {
                    MostrarError("Empleado no encontrado");
                    return;
                }

                Console.WriteLine($"\nEmpleado: {empleado.Nombre}");
                Console.WriteLine($"Sueldo base: RD${empleado.SueldoBase:N2}");

                Console.WriteLine("\nINGRESE INCENTIVOS:");
                foreach (var key in empleado.Incentivos.Keys.ToList())
                {
                    Console.Write($"{key}: RD$");
                    empleado.Incentivos[key] = decimal.Parse(Console.ReadLine());
                }

                Console.Write("\nDescuentos (RD$): ");
                empleado.Descuentos = decimal.Parse(Console.ReadLine());

                MostrarExito("Nómina calculada correctamente");
            }
            catch
            {
                MostrarError("Datos inválidos");
            }
        }

        static void MostrarRecibo()
        {
            Console.Clear();
            Console.WriteLine("📄 RECIBO DE PAGO\n");

            try
            {
                Console.Write("ID del empleado: ");
                var id = int.Parse(Console.ReadLine());
                var empleado = empleados.FirstOrDefault(e => e.Id == id);

                if (empleado == null)
                {
                    MostrarError("Empleado no encontrado");
                    return;
                }

                var totalIncentivos = empleado.Incentivos.Values.Sum();
                var salarioNeto = empleado.SueldoBase + totalIncentivos - empleado.Descuentos;

                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("\n═══════════════════════════════════════════════");
                Console.WriteLine($"           {EmpresaInfo.Nombre}");
                Console.WriteLine("═══════════════════════════════════════════════");
                Console.ForegroundColor = ConsoleColor.White;

                Console.WriteLine($"Empleado: {empleado.Nombre.ToUpper()}");
                Console.WriteLine($"Cédula: {empleado.Cedula}");
                Console.WriteLine($"Cargo: {empleado.Cargo}");
                Console.WriteLine($"Fecha ingreso: {empleado.FechaContratacion:dd/MM/yyyy}");
                
                if (File.Exists(empleado.FotoPerfilPath))
                {
                    Console.WriteLine($"\nFoto perfil: {Path.GetFileName(empleado.FotoPerfilPath)}");
                }

                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("\n───────────────────────────────────────────────");
                Console.ForegroundColor = ConsoleColor.White;

                Console.WriteLine($"Sueldo base: RD${empleado.SueldoBase:N2}");

                Console.WriteLine("\nINCENTIVOS:");
                foreach (var incentivo in empleado.Incentivos)
                {
                    Console.WriteLine($"{incentivo.Key}: RD${incentivo.Value:N2}");
                }

                Console.WriteLine($"\nTotal incentivos: RD${totalIncentivos:N2}");
                Console.WriteLine($"Descuentos: RD${empleado.Descuentos:N2}");

                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("\n───────────────────────────────────────────────");
                Console.ForegroundColor = ConsoleColor.White;

                Console.WriteLine($"TOTAL A PAGAR: RD${salarioNeto:N2}");

                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("═══════════════════════════════════════════════");
                Console.ForegroundColor = ConsoleColor.White;

                Console.WriteLine("\nPresione cualquier tecla para continuar...");
                Console.ReadKey();
            }
            catch
            {
                MostrarError("Error al generar recibo");
            }
        }

        static void AsignarFoto()
        {
            Console.Clear();
            Console.WriteLine("📸 ASIGNAR FOTO A EMPLEADO\n");

            try
            {
                Console.Write("ID del empleado: ");
                var id = int.Parse(Console.ReadLine());
                var empleado = empleados.FirstOrDefault(e => e.Id == id);

                if (empleado == null)
                {
                    MostrarError("Empleado no encontrado");
                    return;
                }

                Console.WriteLine($"\nEmpleado: {empleado.Nombre}");
                Console.WriteLine($"Foto actual: {(string.IsNullOrEmpty(empleado.FotoPerfilPath) ? "Ninguna" : Path.GetFileName(empleado.FotoPerfilPath))}");

                Console.WriteLine("\nOpciones:");
                Console.WriteLine("1. Usar foto de ejemplo");
                Console.WriteLine("2. Especificar ruta de imagen");
                Console.Write("\nSeleccione: ");
                var opcion = Console.ReadLine();

                switch (opcion)
                {
                    case "1":
                        empleado.FotoPerfilPath = fotoEjemploPath;
                        MostrarExito("Foto de ejemplo asignada");
                        break;
                    case "2":
                        Console.Write("\nRuta completa de la imagen: ");
                        var ruta = Console.ReadLine();
                        if (File.Exists(ruta))
                        {
                            var extension = Path.GetExtension(ruta).ToLower();
                            if (extension == ".jpg" || extension == ".jpeg" || extension == ".png")
                            {
                                var destino = Path.Combine(directorioFotos, $"empleado_{id}{extension}");
                                File.Copy(ruta, destino, true);
                                empleado.FotoPerfilPath = destino;
                                MostrarExito("Foto asignada correctamente");
                            }
                            else
                            {
                                MostrarError("Formato no válido (solo JPG/PNG)");
                            }
                        }
                        else
                        {
                            MostrarError("Archivo no encontrado");
                        }
                        break;
                    default:
                        MostrarError("Opción inválida");
                        break;
                }
            }
            catch (Exception ex)
            {
                MostrarError($"Error: {ex.Message}");
            }
        }

        static void VerFoto()
        {
            Console.Clear();
            Console.WriteLine("🖼️ VER FOTO DE EMPLEADO\n");

            try
            {
                Console.Write("ID del empleado: ");
                var id = int.Parse(Console.ReadLine());
                var empleado = empleados.FirstOrDefault(e => e.Id == id);

                if (empleado == null)
                {
                    MostrarError("Empleado no encontrado");
                    return;
                }

                if (string.IsNullOrEmpty(empleado.FotoPerfilPath) || !File.Exists(empleado.FotoPerfilPath))
                {
                    MostrarError("El empleado no tiene foto asignada o no se encuentra");
                    return;
                }

                Console.WriteLine($"\nMostrando foto de: {empleado.Nombre}");
                Console.WriteLine($"Ruta: {empleado.FotoPerfilPath}");

                try
                {
                    System.Diagnostics.Process.Start(new System.Diagnostics.ProcessStartInfo
                    {
                        FileName = empleado.FotoPerfilPath,
                        UseShellExecute = true
                    });
                }
                catch
                {
                    Console.WriteLine("\nNo se pudo abrir el visor de imágenes.");
                    Console.WriteLine("Puede ver la imagen manualmente en la ruta indicada.");
                }

                Console.WriteLine("\nPresione cualquier tecla para continuar...");
                Console.ReadKey();
            }
            catch
            {
                MostrarError("ID inválido");
            }
        }

        static void MostrarExito(string mensaje)
        {
            Console.ForegroundColor = ConsoleColor.Green;
            Console.WriteLine($"\n✅ {mensaje}");
            Console.ForegroundColor = ConsoleColor.White;
            Console.ReadKey();
        }

        static void MostrarError(string mensaje)
        {
            Console.ForegroundColor = ConsoleColor.Red;
            Console.WriteLine($"\n❌ {mensaje}");
            Console.ForegroundColor = ConsoleColor.White;
            Console.ReadKey();
        }
    }
}